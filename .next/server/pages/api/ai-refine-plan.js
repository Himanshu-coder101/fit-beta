"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/ai-refine-plan";
exports.ids = ["pages/api/ai-refine-plan"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fai-refine-plan&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cai-refine-plan.js&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fai-refine-plan&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cai-refine-plan.js&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_ai_refine_plan_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\ai-refine-plan.js */ \"(api)/./pages/api/ai-refine-plan.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_ai_refine_plan_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_ai_refine_plan_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/ai-refine-plan\",\n        pathname: \"/api/ai-refine-plan\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_ai_refine_plan_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmFpLXJlZmluZS1wbGFuJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNhaS1yZWZpbmUtcGxhbi5qcyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUM0RDtBQUM1RDtBQUNBLGlFQUFlLHdFQUFLLENBQUMseURBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLHlEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovL2ZpdHRyYWNrLXByby8/YmM2ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXGFpLXJlZmluZS1wbGFuLmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYWktcmVmaW5lLXBsYW5cIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9haS1yZWZpbmUtcGxhblwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fai-refine-plan&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cai-refine-plan.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/ai-refine-plan.js":
/*!*************************************!*\
  !*** ./pages/api/ai-refine-plan.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n// pages/api/ai-refine-plan.js\nasync function handler(req, res) {\n    if (req.method !== \"POST\") return res.status(405).json({\n        error: \"Method not allowed\"\n    });\n    const body = req.body || {};\n    const { plan, profile } = body;\n    if (!plan || !plan.sessions) return res.status(400).json({\n        error: \"Invalid plan payload\"\n    });\n    const OPENAI_KEY = process.env.OPENAI_API_KEY || \"\";\n    // If no key, return plan unchanged (fallback)\n    if (!OPENAI_KEY) {\n        return res.status(200).json({\n            refined: plan,\n            note: \"no-openai-key-fallback\"\n        });\n    }\n    // Build a compact prompt that asks the model to:\n    // - ensure plan matches goal\n    // - add per-exercise coaching notes and brief rationale\n    // - short JSON-only response with unchanged structure but with \"coaching\" fields\n    const system = `You are a professional strength & conditioning coach. \r\nRespond in strict JSON only: the exact plan object with the same keys as provided (sessions -> exercises),\r\nbut for each exercise add a \"coach_note\" (1-2 short sentences) and \"why_chosen\" (one short reason).\r\nDo not add extra keys. Keep coaching concise and practical.`;\n    // Build a clean payload summarizing plan (not full huge details) for the model\n    const planSummary = {\n        profile: profile || plan.profile || {},\n        sessions: plan.sessions.map((s)=>({\n                day: s.day,\n                sessionType: s.sessionType || null,\n                exercises: s.exercises.map((e)=>({\n                        name: e.name,\n                        primary: e.primary || null,\n                        movement: e.movement || null,\n                        sets: e.sets,\n                        reps: e.reps\n                    }))\n            }))\n    };\n    const userPrompt = `Refine the following plan for goal=\"${profile && profile.goal || plan.profile && plan.profile.goal || \"General\"}\".\r\nMake sure exercises match the goal. For each exercise add short 'coach_note' and 'why_chosen'.\r\nReturn only valid JSON matching the original structure with coaching fields.\r\n\r\nPlan:\r\n${JSON.stringify(planSummary, null, 2)}\r\n`;\n    try {\n        const openaiRes = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n            method: \"POST\",\n            headers: {\n                \"Authorization\": `Bearer ${OPENAI_KEY}`,\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                model: \"gpt-4o-mini\",\n                messages: [\n                    {\n                        role: \"system\",\n                        content: system\n                    },\n                    {\n                        role: \"user\",\n                        content: userPrompt\n                    }\n                ],\n                max_tokens: 1200,\n                temperature: 0.3,\n                n: 1\n            })\n        });\n        if (!openaiRes.ok) {\n            const txt = await openaiRes.text();\n            return res.status(500).json({\n                error: \"OpenAI error\",\n                details: txt\n            });\n        }\n        const j = await openaiRes.json();\n        // The assistant reply likely contains JSON â€” attempt to parse\n        const reply = j.choices?.[0]?.message?.content || j.choices?.[0]?.text || \"\";\n        // Try to extract JSON from the reply\n        const jsonStart = reply.indexOf(\"{\");\n        const jsonText = jsonStart >= 0 ? reply.slice(jsonStart) : reply;\n        let refined;\n        try {\n            refined = JSON.parse(jsonText);\n        } catch (parseErr) {\n            // As fallback, return original plan with a note\n            return res.status(200).json({\n                refined: plan,\n                warning: \"could-not-parse-model-output\",\n                raw: reply\n            });\n        }\n        return res.status(200).json({\n            refined,\n            note: \"refined-by-openai\"\n        });\n    } catch (err) {\n        return res.status(500).json({\n            error: \"internal\",\n            details: err.message\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ3JDLE1BQU1NLFlBQVlILE1BQU1JLE9BQU8sQ0FBQztRQUNoQyxNQUFNQyxXQUFXRixhQUFhLElBQUlILE1BQU1NLEtBQUssQ0FBQ0gsYUFBYUg7UUFFM0QsSUFBSWxDO1FBQ0osSUFBSTtZQUNGQSxVQUFVaUIsS0FBS3dCLEtBQUssQ0FBQ0Y7UUFDdkIsRUFBRSxPQUFPRyxVQUFVO1lBQ2pCLGdEQUFnRDtZQUNoRCxPQUFPdkQsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRVUsU0FBU1A7Z0JBQU1rRCxTQUFTO2dCQUFnQ0MsS0FBS1Y7WUFBTTtRQUNuRztRQUVBLE9BQU8vQyxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVVO1lBQVNDLE1BQU07UUFBb0I7SUFDbkUsRUFBRSxPQUFPNEMsS0FBSztRQUNaLE9BQU8xRCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87WUFBWXlDLFNBQVNhLElBQUlULE9BQU87UUFBQztJQUN4RTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZml0dHJhY2stcHJvLy4vcGFnZXMvYXBpL2FpLXJlZmluZS1wbGFuLmpzPzllMzUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gcGFnZXMvYXBpL2FpLXJlZmluZS1wbGFuLmpzXHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XHJcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xyXG5cclxuICBjb25zdCBib2R5ID0gcmVxLmJvZHkgfHwge307XHJcbiAgY29uc3QgeyBwbGFuLCBwcm9maWxlIH0gPSBib2R5O1xyXG5cclxuICBpZiAoIXBsYW4gfHwgIXBsYW4uc2Vzc2lvbnMpIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnSW52YWxpZCBwbGFuIHBheWxvYWQnIH0pO1xyXG5cclxuICBjb25zdCBPUEVOQUlfS0VZID0gcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkgfHwgJyc7XHJcblxyXG4gIC8vIElmIG5vIGtleSwgcmV0dXJuIHBsYW4gdW5jaGFuZ2VkIChmYWxsYmFjaylcclxuICBpZiAoIU9QRU5BSV9LRVkpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHJlZmluZWQ6IHBsYW4sIG5vdGU6ICduby1vcGVuYWkta2V5LWZhbGxiYWNrJyB9KTtcclxuICB9XHJcblxyXG4gIC8vIEJ1aWxkIGEgY29tcGFjdCBwcm9tcHQgdGhhdCBhc2tzIHRoZSBtb2RlbCB0bzpcclxuICAvLyAtIGVuc3VyZSBwbGFuIG1hdGNoZXMgZ29hbFxyXG4gIC8vIC0gYWRkIHBlci1leGVyY2lzZSBjb2FjaGluZyBub3RlcyBhbmQgYnJpZWYgcmF0aW9uYWxlXHJcbiAgLy8gLSBzaG9ydCBKU09OLW9ubHkgcmVzcG9uc2Ugd2l0aCB1bmNoYW5nZWQgc3RydWN0dXJlIGJ1dCB3aXRoIFwiY29hY2hpbmdcIiBmaWVsZHNcclxuICBjb25zdCBzeXN0ZW0gPSBgWW91IGFyZSBhIHByb2Zlc3Npb25hbCBzdHJlbmd0aCAmIGNvbmRpdGlvbmluZyBjb2FjaC4gXHJcblJlc3BvbmQgaW4gc3RyaWN0IEpTT04gb25seTogdGhlIGV4YWN0IHBsYW4gb2JqZWN0IHdpdGggdGhlIHNhbWUga2V5cyBhcyBwcm92aWRlZCAoc2Vzc2lvbnMgLT4gZXhlcmNpc2VzKSxcclxuYnV0IGZvciBlYWNoIGV4ZXJjaXNlIGFkZCBhIFwiY29hY2hfbm90ZVwiICgxLTIgc2hvcnQgc2VudGVuY2VzKSBhbmQgXCJ3aHlfY2hvc2VuXCIgKG9uZSBzaG9ydCByZWFzb24pLlxyXG5EbyBub3QgYWRkIGV4dHJhIGtleXMuIEtlZXAgY29hY2hpbmcgY29uY2lzZSBhbmQgcHJhY3RpY2FsLmA7XHJcblxyXG4gIC8vIEJ1aWxkIGEgY2xlYW4gcGF5bG9hZCBzdW1tYXJpemluZyBwbGFuIChub3QgZnVsbCBodWdlIGRldGFpbHMpIGZvciB0aGUgbW9kZWxcclxuICBjb25zdCBwbGFuU3VtbWFyeSA9IHtcclxuICAgIHByb2ZpbGU6IHByb2ZpbGUgfHwgcGxhbi5wcm9maWxlIHx8IHt9LFxyXG4gICAgc2Vzc2lvbnM6IHBsYW4uc2Vzc2lvbnMubWFwKHMgPT4gKHtcclxuICAgICAgZGF5OiBzLmRheSxcclxuICAgICAgc2Vzc2lvblR5cGU6IHMuc2Vzc2lvblR5cGUgfHwgbnVsbCxcclxuICAgICAgZXhlcmNpc2VzOiBzLmV4ZXJjaXNlcy5tYXAoZSA9PiAoeyBuYW1lOiBlLm5hbWUsIHByaW1hcnk6IGUucHJpbWFyeSB8fCBudWxsLCBtb3ZlbWVudDogZS5tb3ZlbWVudCB8fCBudWxsLCBzZXRzOiBlLnNldHMsIHJlcHM6IGUucmVwcyB9KSlcclxuICAgIH0pKVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IHVzZXJQcm9tcHQgPSBgUmVmaW5lIHRoZSBmb2xsb3dpbmcgcGxhbiBmb3IgZ29hbD1cIiR7KHByb2ZpbGUgJiYgcHJvZmlsZS5nb2FsKSB8fCAocGxhbi5wcm9maWxlICYmIHBsYW4ucHJvZmlsZS5nb2FsKSB8fCAnR2VuZXJhbCd9XCIuXHJcbk1ha2Ugc3VyZSBleGVyY2lzZXMgbWF0Y2ggdGhlIGdvYWwuIEZvciBlYWNoIGV4ZXJjaXNlIGFkZCBzaG9ydCAnY29hY2hfbm90ZScgYW5kICd3aHlfY2hvc2VuJy5cclxuUmV0dXJuIG9ubHkgdmFsaWQgSlNPTiBtYXRjaGluZyB0aGUgb3JpZ2luYWwgc3RydWN0dXJlIHdpdGggY29hY2hpbmcgZmllbGRzLlxyXG5cclxuUGxhbjpcclxuJHtKU09OLnN0cmluZ2lmeShwbGFuU3VtbWFyeSwgbnVsbCwgMil9XHJcbmA7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBvcGVuYWlSZXMgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hcGkub3BlbmFpLmNvbS92MS9jaGF0L2NvbXBsZXRpb25zJywge1xyXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke09QRU5BSV9LRVl9YCxcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgIH0sXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBtb2RlbDogJ2dwdC00by1taW5pJywgLy8gY2hhbmdlIHRvIGEgbW9kZWwgeW91IHByZWZlciwgb3IgZ3B0LTQgaWYgYXZhaWxhYmxlXHJcbiAgICAgICAgbWVzc2FnZXM6IFtcclxuICAgICAgICAgIHsgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN5c3RlbSB9LFxyXG4gICAgICAgICAgeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IHVzZXJQcm9tcHQgfVxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgbWF4X3Rva2VuczogMTIwMCxcclxuICAgICAgICB0ZW1wZXJhdHVyZTogMC4zLFxyXG4gICAgICAgIG46IDFcclxuICAgICAgfSlcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghb3BlbmFpUmVzLm9rKSB7XHJcbiAgICAgIGNvbnN0IHR4dCA9IGF3YWl0IG9wZW5haVJlcy50ZXh0KCk7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnT3BlbkFJIGVycm9yJywgZGV0YWlsczogdHh0IH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGogPSBhd2FpdCBvcGVuYWlSZXMuanNvbigpO1xyXG4gICAgLy8gVGhlIGFzc2lzdGFudCByZXBseSBsaWtlbHkgY29udGFpbnMgSlNPTiDigJQgYXR0ZW1wdCB0byBwYXJzZVxyXG4gICAgY29uc3QgcmVwbHkgPSBqLmNob2ljZXM/LlswXT8ubWVzc2FnZT8uY29udGVudCB8fCBqLmNob2ljZXM/LlswXT8udGV4dCB8fCAnJztcclxuICAgIC8vIFRyeSB0byBleHRyYWN0IEpTT04gZnJvbSB0aGUgcmVwbHlcclxuICAgIGNvbnN0IGpzb25TdGFydCA9IHJlcGx5LmluZGV4T2YoJ3snKTtcclxuICAgIGNvbnN0IGpzb25UZXh0ID0ganNvblN0YXJ0ID49IDAgPyByZXBseS5zbGljZShqc29uU3RhcnQpIDogcmVwbHk7XHJcblxyXG4gICAgbGV0IHJlZmluZWQ7XHJcbiAgICB0cnkge1xyXG4gICAgICByZWZpbmVkID0gSlNPTi5wYXJzZShqc29uVGV4dCk7XHJcbiAgICB9IGNhdGNoIChwYXJzZUVycikge1xyXG4gICAgICAvLyBBcyBmYWxsYmFjaywgcmV0dXJuIG9yaWdpbmFsIHBsYW4gd2l0aCBhIG5vdGVcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgcmVmaW5lZDogcGxhbiwgd2FybmluZzogJ2NvdWxkLW5vdC1wYXJzZS1tb2RlbC1vdXRwdXQnLCByYXc6IHJlcGx5IH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHJlZmluZWQsIG5vdGU6ICdyZWZpbmVkLWJ5LW9wZW5haScgfSk7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ2ludGVybmFsJywgZGV0YWlsczogZXJyLm1lc3NhZ2UgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwiYm9keSIsInBsYW4iLCJwcm9maWxlIiwic2Vzc2lvbnMiLCJPUEVOQUlfS0VZIiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwicmVmaW5lZCIsIm5vdGUiLCJzeXN0ZW0iLCJwbGFuU3VtbWFyeSIsIm1hcCIsInMiLCJkYXkiLCJzZXNzaW9uVHlwZSIsImV4ZXJjaXNlcyIsImUiLCJuYW1lIiwicHJpbWFyeSIsIm1vdmVtZW50Iiwic2V0cyIsInJlcHMiLCJ1c2VyUHJvbXB0IiwiZ29hbCIsIkpTT04iLCJzdHJpbmdpZnkiLCJvcGVuYWlSZXMiLCJmZXRjaCIsImhlYWRlcnMiLCJtb2RlbCIsIm1lc3NhZ2VzIiwicm9sZSIsImNvbnRlbnQiLCJtYXhfdG9rZW5zIiwidGVtcGVyYXR1cmUiLCJuIiwib2siLCJ0eHQiLCJ0ZXh0IiwiZGV0YWlscyIsImoiLCJyZXBseSIsImNob2ljZXMiLCJtZXNzYWdlIiwianNvblN0YXJ0IiwiaW5kZXhPZiIsImpzb25UZXh0Iiwic2xpY2UiLCJwYXJzZSIsInBhcnNlRXJyIiwid2FybmluZyIsInJhdyIsImVyciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/ai-refine-plan.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fai-refine-plan&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cai-refine-plan.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();